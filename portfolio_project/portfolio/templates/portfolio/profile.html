{% extends 'portfolio/base.html' %}

{% block title %}Мой профиль{% endblock %}
{% block header %}Мой профиль{% endblock %}

{% block content %}
{% if teacher and not edit_mode %}
<div class="card mb-4">
    <div class="card-body text-center">
        <div class="profile-photo mb-3">
            {% if teacher.photo %}
                <img src="{{ teacher.photo.url }}" class="rounded-circle" alt="Фото" style="width: 150px; height: 150px; object-fit: cover;">
                <!-- Форма для удаления фото -->
                <form method="post" class="mt-2">
                    {% csrf_token %}
                    <button type="submit" name="delete_photo" class="btn btn-sm btn-outline-danger">
                        <i class="fas fa-trash"></i> Удалить фото
                    </button>
                </form>
            {% else %}
                <div class="rounded-circle bg-light d-flex align-items-center justify-content-center" 
                     style="width: 150px; height: 150px; border: 1px solid #dee2e6;">
                    <i class="fas fa-user fa-3x text-muted"></i>
                </div>
            {% endif %}
        </div>
        
        <h3 class="card-title">{{ teacher.last_name }} {{ teacher.first_name }}</h3>
        {% if teacher.middle_name %}
        <p class="text-muted">{{ teacher.middle_name }}</p>
        {% endif %}
        
        {% if teacher.category != 'No category' %}
        <div class="mb-3">
            <span class="badge bg-primary">{{ teacher.get_category_display }}</span>
            {% if teacher.certification_date %}
            <small class="d-block text-muted">с {{ teacher.certification_date|date:"d.m.Y" }}</small>
            {% endif %}
        </div>
        {% endif %}
        
        <div class="d-grid gap-2 d-md-flex justify-content-md-end mb-4">
            <a href="{% url 'portfolio:profile' %}?edit=true" class="btn btn-primary">
                <i class="fas fa-edit"></i> Редактировать профиль
            </a>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header">
                Основная информация
            </div>
            <div class="card-body">
                <p><strong>Дата рождения:</strong> {{ teacher.birth_date|date:"d.m.Y" }}</p>
                <p><strong>Email:</strong> {{ teacher.email }}</p>
                <p><strong>Телефон:</strong> {{ teacher.phone }}</p>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="card mb-4">
            <div class="card-header">
                Дополнительная информация
            </div>
            <div class="card-body">
                {% if teacher.biography %}
                <p><strong>Биография:</strong> {{ teacher.biography|linebreaks }}</p>
                {% endif %}
                
                {% if teacher.interests %}
                <p><strong>Интересы:</strong> {{ teacher.interests }}</p>
                {% endif %}
                
                {% if teacher.teaching_problem %}
                <p><strong>Педагогическая проблема:</strong> {{ teacher.teaching_problem|linebreaks }}</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <span>
            {% if teacher %}Редактирование профиля{% else %}Создание профиля{% endif %}
        </span>
        {% if teacher %}
        <a href="{% url 'portfolio:profile' %}" class="btn btn-sm btn-outline-secondary">
            <i class="fas fa-times"></i> Отмена
        </a>
        {% endif %}
    </div>
    <div class="card-body">
        {% if form %}
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            
            {% if form.errors %}
            <div class="alert alert-danger">
                Пожалуйста, исправьте ошибки ниже.
            </div>
            {% endif %}
            
            <div class="row mb-3">
                <div class="col-md-6">
                    <div class="form-group">
                        <label class="form-label">Фамилия *</label>
                        {{ form.last_name }}
                        {% if form.last_name.errors %}
                        <div class="text-danger">
                            {% for error in form.last_name.errors %}
                                {{ error|escape }}
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label class="form-label">Имя *</label>
                        {{ form.first_name }}
                        {% if form.first_name.errors %}
                        <div class="text-danger">
                            {% for error in form.first_name.errors %}
                                {{ error|escape }}
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <div class="mb-3">
                <div class="form-group">
                    <label class="form-label">Отчество</label>
                    {{ form.middle_name }}
                </div>
            </div>
            
            <div class="row mb-3">
                <div class="col-md-6">
                    <div class="form-group">
                        <label class="form-label">Дата рождения *</label>
                        {{ form.birth_date }}
                        {% if form.birth_date.errors %}
                        <div class="text-danger">
                            {% for error in form.birth_date.errors %}
                                {{ error|escape }}
                            {% endfor %}
                        </div>
                        {% endif %}
                        <small class="form-text text-muted">Пример: 01.01.1990</small>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        {{ form.email }}
                        <small class="form-text text-muted">Пример: example@example.com</small>
                    </div>
                </div>
            </div>
            
            <div class="mb-3">
                <div class="form-group">
                    <label class="form-label">Телефон</label>
                    {{ form.phone }}
                    <small class="form-text text-muted">Пример: +7 (999) 123-45-67</small>
                    {% if form.phone.errors %}
                    <div class="text-danger">
                        {% for error in form.phone.errors %}
                            {{ error|escape }}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <div class="mb-3">
                <div class="form-group">
                    <label class="form-label">Категория</label>
                    {{ form.category }}
                </div>
            </div>
            
            <div class="row mb-3">
                <div class="col-md-6">
                    <div class="form-group">
                        <label class="form-label">Дата аттестации</label>
                        {{ form.certification_date }}
                        <small class="form-text text-muted">Пример: 01.01.2020</small>
                        {% if form.certification_date.errors %}
                        <div class="text-danger">
                            {% for error in form.certification_date.errors %}
                                {{ error|escape }}
                            {% endfor %}
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <div class="mb-3">
                <div class="form-group">
                    <label class="form-label">Биография</label>
                    {{ form.biography }}
                    <small class="form-text text-muted">Краткая информация о вашей профессиональной деятельности</small>
                </div>
            </div>
            
            <div class="mb-3">
                <div class="form-group">
                    <label class="form-label">Интересы</label>
                    {{ form.interests }}
                    <small class="form-text text-muted">Ваши профессиональные и личные интересы</small>
                </div>
            </div>
            
            <div class="mb-3">
                <div class="form-group">
                    <label class="form-label">Педагогическая проблема</label>
                    {{ form.teaching_problem }}
                    <small class="form-text text-muted">Проблема, над которой вы работаете в педагогической деятельности</small>
                </div>
            </div>
            
            <div class="mb-3">
                <div class="form-group">
                    <label class="form-label">Фото</label>
                    {{ form.photo }}
                    <small class="form-text text-muted">Поддерживаемые форматы: JPG, PNG. Максимальный размер: 5 МБ</small>
                    {% if form.photo.errors %}
                    <div class="text-danger">
                        {% for error in form.photo.errors %}
                            {{ error|escape }}
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                {% if teacher %}
                <a href="{% url 'portfolio:profile' %}" class="btn btn-secondary">Отмена</a>
                {% else %}
                <a href="{% url 'portfolio:home' %}" class="btn btn-secondary">Отмена</a>
                {% endif %}
                <button type="submit" name="save" class="btn btn-primary">
                    <i class="fas fa-save"></i> Сохранить
                </button>
            </div>
        </form>
        {% else %}
        <div class="text-center py-4">
            <h4>Профиль не создан</h4>
            <p class="text-muted mb-4">Для создания профиля нажмите кнопку ниже</p>
            <a href="{% url 'portfolio:profile' %}?edit=true" class="btn btn-primary">
                <i class="fas fa-user-plus"></i> Создать профиль
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endif %}

<div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
    <a href="{% url 'portfolio:home' %}" class="btn btn-secondary">Назад на главную</a>
</div>
{% endblock %}