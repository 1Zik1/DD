{% extends 'portfolio/base.html' %}
{% block title %}Награды{% endblock %}
{% block header %}Награды{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Список наград</h2>
    <a href="{% url 'portfolio:award_create' %}" class="btn btn-primary">
        <i class="fas fa-plus"></i> Добавить награду
    </a>
</div>

{% if awards %}
<table class="table table-striped table-hover">
    <thead class="table-light">
        <tr>
            <th>Название</th>
            <th>Организация</th>
            <th>Дата получения</th>
            <th>Уровень</th>
            <th>Файлы</th> 
            <th>Действия</th>
        </tr>
    </thead>
    <tbody>
        {% for award in awards %}
        <tr>
            <td>{{ award.name }}</td>
            <td>{{ award.organization }}</td>
            <td>{{ award.received_date|date:"d.m.Y" }}</td>
            <td>
                {% if award.level == 'State' %}Государственная{% endif %}
                {% if award.level == 'Regional' %}Региональная{% endif %}
                {% if award.level == 'Departmental' %}Ведомственная{% endif %}
                {% if award.level == 'Other' %}Другая{% endif %}
            </td>
            <td>
                <!-- Отображение файлоа -->
                {% if award.files.all %}
                    <div class="d-flex flex-wrap gap-2">
                        {% for file in award.files.all %}
                            <!-- Проверка -->
                            {% if file.file_type in image_file_types %}
                                <!-- Миниатюра изображения -->
                                <a 
                                    href="#" 
                                    class="image-preview" 
                                    data-src="{{ file.file_path.url }}" 
                                    data-title="{{ file.file_name }}" 
                                    data-description="{{ file.description|default:'' }}"
                                >
                                    <img src="{{ file.file_path.url }}" alt="{{ file.file_name }}" class="img-thumbnail" style="max-width: 80px; max-height: 80px;">
                                </a>
                            {% else %}
                                <!-- Ссылка на другие файлы -->
                                <a href="{{ file.file_path.url }}" target="_blank" class="text-decoration-none">
                                    <i class="fas fa-file"></i> {{ file.file_name }}
                                </a>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% else %}
                    <span class="text-muted">—</span>
                {% endif %}
            </td>
            <td>
                <div class="d-flex gap-2">
                    <a href="{% url 'portfolio:award_edit' award.pk %}" class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-edit"></i>
                    </a>
                    <a href="{% url 'portfolio:award_delete' award.pk %}" class="btn btn-sm btn-outline-danger">
                        <i class="fas fa-trash"></i>
                    </a>
                </div>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<div class="alert alert-info">
    <i class="fas fa-info-circle"></i> У вас пока нет записей о наградах
</div>
{% endif %}

<div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
    <a href="{% url 'portfolio:home' %}" class="btn btn-secondary">Назад на главную</a>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const imagePreviews = document.querySelectorAll('.image-preview');
    
    // Обработчик клика по миниатюре
    imagePreviews.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            
            const src = this.getAttribute('data-src');
            const title = this.getAttribute('data-title');
            const description = this.getAttribute('data-description');
            
            // модальное окно
            document.getElementById('modalImage').src = src;
            document.getElementById('imageModalLabel').textContent = title;
            document.getElementById('modalDescription').textContent = description || '';
            
            // Открытие модального окна
            const modal = new bootstrap.Modal(document.getElementById('imageModal'));
            modal.show();
        });
    });
});
</script>
{% endblock %}